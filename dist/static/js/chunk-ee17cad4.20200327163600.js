(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee17cad4"],{"08a4":function(e,t,r){e.exports=r.p+"static/img/default-poster@2x.f3a17f3f.png"},1964:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"share-player-container",class:{vertical:e.vertical}},[0!==+e.options.liveStatus||e.vertical?e._e():i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isError,expression:"!isError"}],staticClass:"not-start-container"},[e.vertical?e._e():i("div",{staticClass:"not-start-wrapper"},[i("h1",{staticClass:"live-room-name"},[e._v(e._s(e.options.liveTitle))]),i("div",{staticClass:"text-mid"},[e._v("距离开始还有")]),i("div",{staticClass:"live-clock"},[e._v(e._s(e.clockText))])]),i("img",{staticClass:"bg",attrs:{src:e.options.poster,alt:""}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isError,expression:"isError"}],staticClass:"player-error-msg",class:{horizontal:!e.vertical}},[i("div",[i("img",{staticClass:"icon",attrs:{src:r("79b1"),alt:""}}),i("p",[e._v(e._s(e.errorMsg))])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPlayBtn,expression:"showPlayBtn"}],staticClass:"vertical-player",class:{vertical:e.vertical,hidden:1!==+e.options.liveStatus},on:{click:function(t){return t.target!==t.currentTarget?null:e.togglePlay(t)}}}),i("div",{staticClass:"share-player-wrapper",attrs:{id:"share-player-wrapper"}})])},n=[],a=(r("163d"),r("08a4")),o=r.n(a),s=r("fe7f"),c=r.n(s),l={name:"vPlayer",props:{errorCode:{type:Number,default:0},vertical:{type:Boolean,default:!1},options:{type:Object}},data:function(){return{player:null,showPlayBtn:!0,isError:this.errorCode>0,nowTime:Date.now()}},watch:{errorCode:function(e){this.isError=e>0}},computed:{errorMsg:function(){var e="";switch(this.errorCode){case 1:e="直播已结束";break;case 2:e="准备中，请晚点再来";break;case 3:e="网络似乎中断了，请检查网络设置";break}return e},clockText:function(){var e=this.options.liveBeginTime,t=this.nowTime,r=new Date(e),i=parseInt((r-t)/1e3),n=parseInt(i/86400),a=parseInt(i%86400/3600),o=parseInt(i%86400%3600/60),s=parseInt(i%86400%3600%60),c="";return n>0&&(c="".concat(n,"天 ")),"".concat(c).concat(a>=10?a:"0"+a,":").concat(o>=10?o:"0"+o,":").concat(s>=10?s:"0"+s)}},methods:{initPlayer:function(){var e=this;this.$nextTick((function(){var t=e.options,r=t.src,i=t.autoplay,n=void 0!==i&&i,a=t.volume,s=void 0===a?1:a,l=t.liveStatus,u=void 0===l?0:l,p=e.options.poster||(e.vertical?c.a:o.a);e.player=new window.TcPlayer("share-player-wrapper",{m3u8:r,poster:{style:"stretch",src:p},controls:e.vertical?"none":"default",autoplay:n,live:1*u===1,volume:s,pausePosterEnabled:!1,x5_orientation:1,x5_player:!1,systemFullscreen:!0,x5_fullscreen:"true",listener:function(t){"error"===t.type.toLowerCase()&&(e.isError=!0,"no live"!==r&&e.$emit("onError",t)),"playing"===t.type.toLowerCase()&&(e.showPlayBtn=!1,e.$emit("onPlay")),"pause"===t.type.toLowerCase()&&(e.showPlayBtn=!0,e.$emit("onPause"))}}),e.player.video.el.setAttribute("x5-playsinline",!0),e.vertical&&e.player.video.el.setAttribute("x5-video-player-type","h5"),1!==u&&e.changeClock(),e.handleVisibilityChange()}))},togglePlay:function(){this.player.togglePlay()},changeClock:function(){var e=this,t=setTimeout((function(){e.nowTime=Date.now(),clearTimeout(t),e.nowTime<new Date(e.options.liveBeginTime)||1!==e.options.liveStatus?(e.changeClock(),e.$emit("countDownRun")):e.$emit("countDownOver")}),1e3)},handleVisibilityChange:function(){var e,t,r=this;"undefined"!==typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document.addEventListener(t,(function(){document[e]?r.player.pause():r.player.play()}),!1)}},mounted:function(){var e=this;this.$nextTick((function(){e.initPlayer()}))}},u=l,p=(r("4eb9"),r("623f")),d=Object(p["a"])(u,i,n,!1,null,null,null);t["a"]=d.exports},"4eb9":function(e,t,r){"use strict";var i=r("fd9c"),n=r.n(i);n.a},6049:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"vertical-container"},[r("div",{staticClass:"video-content"},[e.playerOpt.src?r("vPlayer",{ref:"player",attrs:{options:e.playerOpt,vertical:!0,"error-code":e.errorCode},on:{onError:e.playError,onPlay:e.playStart,countDownRun:e.countDownRun,onPause:e.playPause}}):e._e(),r("div",{staticClass:"scroll-box-container"},[e.initData.userID&&e.isInit?r("custom-message",{ref:"current-message",attrs:{initData:e.initData},on:{close:e.handleClose,openApp:e.openApp}}):e._e()],1)],1)])},n=[],a=(r("5ab2"),r("6d57"),r("e10e"),r("419a"),r("e980")),o=r("ac9f"),s=r("1964"),c=r("0778"),l=r("398f"),u=r("365c"),p=r("cf45");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={data:function(){return{tabIndex:1,urlParams:h({},this.$route.query),playerOpt:{src:"",poster:"",beginTime:0,liveStatus:0,liveTitle:""},liveInfo:{},rewardShow:0,reportingTime:0,rewardSwitch:0,vodList:[],errorCode:0,desc:"",dateNow:Date.now(),timer:null,isInit:!1,initData:{layout:"vertical",groupID:this.$route.query.groupId,SDKAppID:"",userID:"",userSig:"",zanNums:0,visitsNums:0,userInfo:{userName:"",userAvatar:""},giftInfo:{enable:!1,type:1},teacherInfo:{userPic:"",userName:"",userId:""}},liveFlag:!1}},components:{vPlayer:s["a"],CustomMessage:c["a"]},computed:{},created:function(){console.log(p["a"].getUrl("shopName"),"***************************"),this.getLiveRoomInfo(),this.getDesc(),this.getUserSign()},beforeMount:function(){},mounted:function(){this.$bus.$on("onLivePlayEnd",this.onLivePlayEnd.bind(this))},methods:{getUserSign:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,i,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getUserSign-getUserSign-getUserSign"),t=JSON.parse(window.localStorage.getItem("wx_user_info")),e.prev=2,e.next=5,u["b"].getUserSign({openId:t.openid});case 5:r=e.sent,i=r.userid,n=r.usersign,a=r.sdkappid,this.initData.userID=i,this.initData.userSig=n,this.initData.SDKAppID=a,this.initData.userInfo={userName:t.nickname,userAvatar:t.headimgurl},window.SDKAppID=a,window.tim=this.TIM.create({SDKAppID:a}),this.isInit=!0,o={fromtype:3,type:2,livetype:2},window.szyreport.reportPV({data:{status:"",trial:"",stay_time:"",progress:"",page_category:"3",page:"openclass_main",page_id:"",parm:JSON.stringify(o),f_page:"",f_page_id:"",f_page_location:""},prefix:""}),e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](2),console.log(e.t0);case 23:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}(),getLiveRoomInfo:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,i,n,a,o,s,c,p,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this.urlParams.liveId,console.log("获取直播间信息-获取直播间信息-获取直播间信息-获取直播间信息"),e.prev=2,e.next=5,u["d"].getLiveRoomInfo({liveId:r,shareUrl:window.location.href},{headers:{sessionId:""}});case 5:i=e.sent,n=i.playInfo,a=i.vodList,o=i.vodlist,s=i.reportingTime,c=i.rewardSwitch,p=i.redEnvelopeSwitch,d=i.giftSwitch,this.playerOpt.liveStatus=n.liveState,this.playerOpt.src=n.hlsPlayUrl||"no live",this.playerOpt.beginTime=n.liveBeginTime||0,this.playerOpt.poster=n.liveBackground,this.playerOpt.liveTitle=n.liveTitle,2===this.playerOpt.liveStatus||0===this.playerOpt.liveStatus?(this.errorCode=t?1:2,this.timer&&clearInterval(this.timer)):this.errorCode=0,this.vodList=a||o,this.reportingTime=s,this.initData.giftInfo.enable=1*c===1,1*d===1?this.initData.giftInfo.type=1:1*p===1&&(this.initData.giftInfo.type=2),this.initData.zanNums=n.liveThumbsupCount||0,this.initData.visitsNums=n.liveWatchUsersNum||0,this.initData.teacherInfo={userPic:n.userPic,userName:n.userName,userId:n.userId},t||(document.title=n.liveTitle,l["b"].$emit("setShareData",{title:n.liveShareInfo.msgTitle,desc:n.liveShareInfo.summary,imgUrl:n.liveShareInfo.shareMsgUrl})),e.next=34;break;case 29:throw e.prev=29,e.t0=e["catch"](2),this.playerOpt.src="no live",this.errorCode=3,e.t0;case 34:case"end":return e.stop()}}),e,this,[[2,29]])})));function t(t){return e.apply(this,arguments)}return t}(),getDesc:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.urlParams.liveId,e.prev=1,e.next=4,u["d"].getDesc({liveId:t});case 4:r=e.sent,i=r.liveIntroduction,this.desc=i,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}(),playError:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.getLiveRoomInfo(!0);case 2:i=r.playerOpt.liveStatus,1===i?setTimeout((function(){window.location.reload()}),1e3):r.playError(),clearTimeout(t);case 5:case"end":return e.stop()}}),e)}))),1e3);case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),reportTime:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";this.timer&&clearInterval(this.timer),this.timer=setInterval(Object(a["a"])(regeneratorRuntime.mark((function i(){var n,a,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=JSON.parse(window.localStorage.getItem("wx_user_info")),a=n.openid,o={liveId:e.urlParams.liveId,watchType:t,terminalType:2,vodId:r,userType:2,openId:a},i.prev=2,i.next=5,u["d"].reportTime(o);case 5:i.next=10;break;case 7:i.prev=7,i.t0=i["catch"](2),console.log(i.t0);case 10:case"end":return i.stop()}}),i,null,[[2,7]])}))),60*this.reportingTime*1e3)},reportStartPlay:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,i,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"LIVE",r=a.length>1&&void 0!==a[1]?a[1]:0,i=a.length>2?a[2]:void 0,n={liveId:this.urlParams.liveId,watchType:r,userType:2,vodId:i},e.prev=4,e.next=7,u["d"].reportPlayStart(t,n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](4),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[4,9]])})));function t(){return e.apply(this,arguments)}return t}(),playStart:function(){this.reportTime()},playPause:function(){this.timer&&clearInterval(this.timer)},openApp:function(){this.$dialog.alert({message:"可能离开微信，打开第三方应用",showCancelButton:!0}).then((function(){console.log("点击了确认按钮噢"),window.location.href=window.location.protocol+"//"+window.location.host+"/live/app-guide?liveId="+p["a"].getUrl("liveId")+"&schoolId="+p["a"].getUrl("schoolId")+"&share_f="+p["a"].getUrl("share_f"),console.log(p["a"].getUrl("liveId"))})).catch((function(){console.log("点击了取消按钮噢2222")}))},handleClose:function(){l["b"].$emit("closeWindow"),window.tim.quitGroup(this.$route.query.groupId).catch((function(){console.log("applyQuitGroup 错误")}))},countDownRun:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getLiveRoomInfo();case 2:t=this.playerOpt.liveStatus,1===t&&setTimeout((function(){window.location.reload()}),3e4);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onLivePlayEnd:function(e){1!==+e.state&&(this.errorCode=1,this.timer&&clearInterval(this.timer))}},beforeRouteLeave:function(e,t,r){var i={clientInfo:{type:3,version:this.urlParams.appVer},senderInfo:{userType:0,userId:this.imInitData.userID,userName:this.imInitData.userInfo.userName,userAvatar:this.imInitData.userInfo.userAvatar},businessInfo:{id:3,type:2},msgInfo:{type:2,body:{streamId:this.urlParams.streamId,joinType:2,joinTip:"退出了直播"}}};u["b"].sendBusinessMsg({groupId:this.imInitData.groupID,msgBody:[{msgType:"TIMCustomElem",msgContent:{data:JSON.stringify(i)}}],fromAccount:this.imInitData.userID}).catch((function(e){console.log(e)})),window.tim.quitGroup(this.$route.query.groupId).catch((function(){console.log("applyQuitGroup 错误")})),r()}},f=v,m=(r("98f3"),r("623f")),g=Object(m["a"])(f,i,n,!1,null,"0d50cf0e",null);t["default"]=g.exports},"79b1":function(e,t,r){e.exports=r.p+"static/img/logo@2x.02a8a5b3.png"},"98f3":function(e,t,r){"use strict";var i=r("fbfa"),n=r.n(i);n.a},fbfa:function(e,t,r){},fd9c:function(e,t,r){},fe7f:function(e,t,r){e.exports=r.p+"static/img/poster-ver.7dbe3503.png"}}]);